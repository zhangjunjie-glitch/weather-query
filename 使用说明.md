# 天气数据查询应用 - 使用说明

## 一、简介

本应用用于查看和导出游戏/项目中的天气配置数据（`weather.xlsx`）。支持日历视图、按日/范围/全部查询、按天气 ID 查时间段、特殊天气、以及**两路径分支对比**，结果可保存为 txt 并一键打开。

**数据来源**：在所选「项目根目录」下，程序自动定位到  
`RawAssets\DesignerAssets\NewDatabase\logic\weather.xlsx`  
（与加载逻辑一致，选择到例如 `H:\zhangjunjie_stage_1` 即可。）

---

## 二、运行环境

- **Python**：3.8 及以上（推荐 3.9 / 3.12）
- **依赖**：pandas、openpyxl（首次运行脚本时会尝试自动安装）

已打包为 exe 时，无需安装 Python，直接运行 exe 即可。

---

## 三、启动方式

### 方式一：源码运行

```bash
# 进入本目录
cd weather

# 安装依赖（若未安装）
pip install -r requirements.txt

# 启动应用
python weather_app.py
```

### 方式二：运行打包后的 exe

双击运行 `dist\WeatherQuery.exe`（打包脚本生成英文名，可自行重命名为 `天气数据查询.exe`）。  
配置文件与默认保存路径会使用 exe 所在目录。

---

## 四、界面说明

### 4.1 顶部栏

| 控件 | 说明 |
|------|------|
| **选择路径** | 选择项目根目录（如 `zhangjunjie_stage_1` 所在目录）。选择后会自动加载该路径下的 `weather.xlsx`。 |
| **路径显示** | 当前已选的项目根目录；首次打开若存在上次记录会显示该路径。 |
| **状态** | 当前是否已加载、加载失败或提示未选择路径。 |

### 4.2 左侧：日历与天气 ID 含义

- **日历**：显示当月，可点击「◀ 上月」「下月 ▶」切换。**点击任意日期**即可在右侧查看该日 24 小时天气。
- **天气 ID 含义**：加载成功后列出所有天气 ID 与对应名称（如 101→晴天，119→小极光等），便于对照。

### 4.3 右侧：查询结果

- **标题**：当前结果说明（如「3月5日 全天天气」「分支对比 路径 A vs 路径 B」等）。
- **文本框**：显示查询或对比的完整内容。
- **选择保存路径** | **保存当前结果到文件** | **打开刚刚保存的文件**
  - 先点「选择保存路径」选择保存目录（未选择时点保存会提示）。
  - 「保存当前结果到文件」将当前文本框内容保存到该目录。
  - 「打开刚刚保存的文件」用系统默认程序打开最后一次保存的文件。

### 4.4 下方：更多功能（选项卡）

| 选项卡 | 功能 |
|--------|------|
| **日期范围** | 输入开始/结束月、日，查询该范围内每日天气；可「查询并保存」。 |
| **全部日期** | 查询全年所有日期的天气；可「查询并保存」。 |
| **查找天气ID** | 输入一个或多个天气 ID（逗号分隔，如 119 或 119,120,121），查询这些天气在全年中的连续时间段（日期 + 起止小时 + 天气名）；可「查询」「查询并保存」。 |
| **特殊天气** | 输入开始/结束月、日，查询该范围内的「特殊天气」时段；可「查询并保存」。 |
| **分支对比** | 路径 A 为当前加载路径，路径 B 需点击「选择路径 B」选择另一项目根目录；对比两路径下 `weather.xlsx` 的 weatherType / weatherList 差异，可「对比并保存」。 |

---

## 五、使用流程

1. **选择路径并加载**  
   点击「选择路径」，选到项目根目录（如 `H:\zhangjunjie_stage_1`）。程序会校验是否存在 `weather.xlsx` 并自动加载，状态会显示「已加载…」。

2. **查看某日天气**  
   在左侧日历中点击某一天，右侧即显示该日 0～24 点逐小时天气。

3. **使用其他查询**  
   切换到下方对应选项卡，输入条件后点击「查询」或「查询并保存」。结果会显示在右侧文本框；若点了「并保存」，需已选「选择保存路径」。

4. **保存与打开**  
   - 首次保存前请先「选择保存路径」。  
   - 保存后可用「打开刚刚保存的文件」直接打开最后一次保存的 txt。

5. **分支对比**  
   - 路径 A 固定为当前加载路径。  
   - 点击「选择路径 B」选择另一个项目根目录。  
   - 点击「对比」或「对比并保存」查看/保存完整差异报告（无省略）。

---

## 六、配置文件

- **位置**：与 `weather_app.py` 或 exe 同目录下的 `weather_app_config.json`。
- **内容**：记录「上次选择的项目根目录」和「上次选择的保存路径」，下次启动会自动带出。
- 可手动编辑或删除该文件以清空记忆路径。

---

## 七、打包说明（生成 exe）

### 7.1 安装打包依赖

```bash
pip install pyinstaller
```

### 7.2 打包命令

在 `weather` 目录下执行（推荐直接双击 **build.bat**）：

```bash
pyinstaller --name "WeatherQuery" --windowed --onefile --clean weather_app.py
```

打包可能需 2～5 分钟（会拉取 pandas 等依赖）。完成后可把 `dist\WeatherQuery.exe` 重命名为 `天气数据查询.exe`。

### 7.3 打包后目录

- **单文件 exe**：`dist\WeatherQuery.exe`。
- 将 **使用说明.md**（或 使用说明.txt）与 exe 放在同一目录便于分发给他人。

### 7.4 为何使用英文名 WeatherQuery

- 若用中文名（如「天气数据查询」）打包，在部分 Windows 环境下会因控制台/PyInstaller 编码与 UTF-8 不一致，生成乱码文件名（如 澶╂皵鏁版嵁鏌ヨ.exe）。
- 因此打包脚本统一使用英文名 **WeatherQuery**，生成 `WeatherQuery.exe`；需要中文名时在资源管理器中重命名为「天气数据查询.exe」即可。若已生成乱码 exe，也可直接重命名为「天气数据查询.exe」使用。

### 7.5 注意事项

- 打包后首次运行若杀毒软件报警，可加入白名单或使用「以管理员运行」。
- 配置文件与「选择保存路径」在 exe 同目录或用户所选目录，不会写系统目录。

---

## 八、常见问题

- **提示「未找到 weather.xlsx」**  
  请确认选择的是**项目根目录**（其下存在 `RawAssets\DesignerAssets\NewDatabase\logic\weather.xlsx`）。

- **保存时提示「请选择保存路径」**  
  先点击「选择保存路径」选择要保存到的文件夹。

- **分支对比提示「路径 A 未设置」**  
  请先在顶部「选择路径」并成功加载数据后再进行对比。

- **对比结果是否完整**  
  是。所有差异项都会输出，不做条数省略。
