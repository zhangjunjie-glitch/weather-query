# 天气数据查询 · 发布与自动更新说明

## 一、把代码上传到 Git（首次）

1. 在 GitHub 上新建仓库（如 `weather-query`），不要勾选「Add a README」。
2. 在本项目目录打开命令行，执行：

```bash
git init
git add .
git commit -m "初始提交：天气数据查询应用"
git branch -M main
git remote add origin https://github.com/你的用户名/weather-query.git
git push -u origin main
```

3. 在 **weather_app.py** 里把 `GITHUB_REPO` 改成你的仓库：

```python
GITHUB_REPO = "你的用户名/weather-query"
```

改完后再次提交并推送：

```bash
git add weather_app.py
git commit -m "配置检查更新用的仓库地址"
git push
```

---

## 二、你这边：更新代码并自动打包发布

每次要发布新版本时：

1. **改版本号**  
   在 **weather_app.py** 顶部修改：

   ```python
   __version__ = "1.0.1"
   ```

2. **提交并推送**：

   ```bash
   git add weather_app.py
   git commit -m "发布 v1.0.1"
   git push
   ```

3. **打 tag 并推送**（触发自动打包）：

   ```bash
   git tag v1.0.1
   git push origin v1.0.1
   ```

4. GitHub 会自动运行「Build and Release」：
   - 用 PyInstaller 打包出 `dist\WeatherQuery\`
   - 打成 zip（如 `WeatherQuery-v1.0.1.zip`）
   - 在「Releases」里创建版本 **v1.0.1** 并上传该 zip

5. 在 GitHub 仓库页面 **Releases** 中可看到新版本和下载链接。

---

## 三、其他人：打开程序后检查更新

1. 用户运行 **WeatherQuery.exe**（或从你发的 zip 里解压运行）。
2. 点击界面上的 **「检查更新」**。
3. 程序会请求 GitHub 的「最新发布」：
   - 若当前版本低于最新发布版本，会提示「发现新版本」，并询问是否打开发布页；
   - 选「是」会打开浏览器到该版本的 Release 页面，用户下载新的 zip，解压覆盖或替换原文件夹即可。
4. 若已是最新版本，会提示「当前已是最新版本」。

**注意**：用户需要能访问 GitHub；若网络受限，可把 zip 发给他们手动替换。

---

## 四、流程小结

| 角色   | 操作 |
|--------|------|
| 你     | 改 `__version__` → 提交 → 打 tag `vx.x.x` → 推送 → GitHub 自动打包并发布 |
| 其他人 | 打开程序 → 点「检查更新」→ 有更新时打开发布页 → 下载 zip 解压使用 |

---

## 五、常见问题

- **检查更新提示「请先配置 GITHUB_REPO」**  
  在 weather_app.py 里把 `GITHUB_REPO` 改成 `你的用户名/仓库名`，重新打包后再发给别人。

- **打 tag 后没有自动打包**  
  到 GitHub 仓库 **Actions** 里看是否有「Build and Release」在跑或失败；失败时看日志（如依赖、路径等）。

- **希望不通过 GitHub 更新**  
  可删掉或隐藏「检查更新」按钮，仍按原方式把 zip 发给别人使用。
