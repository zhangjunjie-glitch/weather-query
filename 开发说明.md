# 天气数据查询应用 - 开发说明

本文档面向**需要修改源代码或自行打包**的开发者。仅使用 exe 的用户请阅读《使用说明.md》。

---

## 一、项目简介

本应用用于读取并查询天气 Excel 数据（`weather.xlsx`），支持日历点选、日期范围查询、按天气 ID 查询、特殊天气统计、多 ID 时间段、双路径对比等，结果可保存为 txt 并打开。

- **数据来源**：项目根目录下的  
  `RawAssets\DesignerAssets\NewDatabase\logic\weather.xlsx`
- **运行方式**：从源码运行（见下文），或使用已打包的 exe（目录版：`dist\WeatherQuery\WeatherQuery.exe`）。

---

## 二、源码结构

| 文件/目录 | 说明 |
|-----------|------|
| **weather_app.py** | 主程序入口，GUI（tkinter）：选择路径、日历、查询区、保存/打开、各功能选项卡。修改界面或流程请改此文件。 |
| **weather.py** | 核心逻辑：读取 Excel、按日/范围/全部查询、按天气 ID 查时间段、特殊天气、双路径对比等。修改查询规则或数据处理请改此文件。 |
| **weather_app_config.json** | 配置文件（与 exe/脚本同目录），保存「上次选择的项目路径」「保存路径」等，程序自动读写。 |
| **requirements.txt** | Python 依赖：pandas、openpyxl。 |
| **build.bat** | 打包脚本（**目录版**）：生成 `dist\WeatherQuery\` 文件夹，运行其中 exe 启动较快。 |
| **build_onefile.bat** | 打包脚本（单文件）：生成单个 `dist\WeatherQuery.exe`。 |
| **WeatherQuery.spec** | PyInstaller 单文件配置；**WeatherQuery_onedir.spec** 为目录版配置。 |
| **使用说明.md** | 给最终用户的使用说明。 |
| **打包说明.txt** | 打包环境、步骤、分发与乱码说明。 |

其他如 `weather_gui.py`、`new_weather.py`、`weather_excel.py` 等为历史或辅助脚本，主程序仅依赖 `weather_app.py` 与 `weather.py`。

---

## 三、环境与依赖

- **Python**：3.8 或以上。
- **依赖安装**（在项目目录下执行）：
  ```bash
  pip install -r requirements.txt
  ```
  主要依赖：`pandas`、`openpyxl`。打包时脚本会自动检测并安装 PyInstaller。

---

## 四、从源码运行

在项目根目录下执行：

```bash
python weather_app.py
```

首次运行若缺少 pandas/openpyxl，程序会提示并尝试自动安装。选择「选择路径」指向包含 `weather.xlsx` 的项目根目录（即其上级路径包含 `RawAssets\DesignerAssets\NewDatabase\logic\weather.xlsx`）即可使用。

---

## 五、如何修改源代码

1. **改界面、按钮、布局、保存路径逻辑**  
   编辑 **weather_app.py**。入口与配置路径通过 `_app_dir()`、`_config_path()` 等处理，打包后 exe 与配置同目录。

2. **改查询逻辑、Excel 读取、对比规则**  
   编辑 **weather.py**。主要类为 `Weather`，方法包括 `read_file()`、`get_weather_list_by_day`、`find_weather_id`、`get_special_weather_in_range`、`find_weather_ids_time_ranges`、`compare_two_paths` 等。

3. **改 Excel 相对路径**  
   - 在 **weather_app.py** 中修改 `EXCEL_REL_PATH`（界面选择路径后拼接用）。
   - 在 **weather.py** 中 `Weather.RELATIVE_EXCEL_PATH` 为默认相对路径，若通过「选择路径」传入则以传入为准。

4. **编码与换行**  
   源码为 UTF-8。Windows 下建议用支持 UTF-8 的编辑器保存，避免中文乱码。

修改后可直接 `python weather_app.py` 测试，确认无误后再打包。

---

## 六、如何打包

- **目录版（推荐，启动快）**  
  双击 **build.bat**，完成后运行 **dist\WeatherQuery\WeatherQuery.exe**。  
  分发时需将整个 **WeatherQuery** 文件夹拷贝给他人，不能只拷贝 exe。

- **单文件 exe**  
  双击 **build_onefile.bat**，生成 **dist\WeatherQuery.exe**。  
  单文件便于拷贝，但首次启动需解压，会稍慢。

更多细节（环境、乱码、体积与启动速度说明）见 **打包说明.txt**。

---

## 七、分发给他人时的建议

- **只发 exe 给用户使用**：  
  发目录版时发整个 **dist\WeatherQuery** 文件夹，并附带 **使用说明.md**（或转为 txt）。

- **希望他人能修改源码并打包**：  
  请压缩并发送下面「分发压缩包清单」中的文件（见下一节）。对方在安装 Python 与依赖后，可按本文档「从源码运行」和「如何打包」操作。

---

## 八、分发压缩包清单（供别人改源码时压缩哪些文件）

**需要全部放进压缩包的文件/文件夹：**

| 类型 | 文件或文件夹 |
|------|----------------|
| 主程序源码 | `weather_app.py`、`weather.py` |
| 依赖说明 | `requirements.txt` |
| 打包配置 | `WeatherQuery.spec`、`WeatherQuery_onedir.spec` |
| 打包脚本 | `build.bat`、`build_onefile.bat` |
| 说明文档 | `使用说明.md`、`开发说明.md`、`打包说明.txt` |

**不要放进压缩包（对方用不到或会自己生成）：**

- `build\`、`dist\`、`__pycache__\`（打包/运行产物，对方自己打包会生成）
- `weather_app_config.json`（本机配置，每人自己生成）
- `output\`（示例输出，可选保留；发给别人改源码时一般不必带）
- 其他如 `weather_gui.py`、`new_weather.py`、`weather_excel.py` 等（主程序未引用，可按需附带）

**操作建议：** 在项目目录下，只勾选上面表格里的 9 个文件，打成 zip/rar，发给对方即可。

---

## 九、相关文档

- **使用说明.md**：功能说明与操作步骤（面向最终用户）。
- **打包说明.txt**：打包环境、步骤、体积/启动说明、分发与乱码处理。
